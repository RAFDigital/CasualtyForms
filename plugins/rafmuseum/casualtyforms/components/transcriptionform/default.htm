<form data-request="onSave">

    <div class="form-group">
        <input type="hidden" name="child_form" value="0" />
        <input id="childForm" type="checkbox" name="child_form"
            value="1" data-toggle="toggle" data-on="No" data-off="Yes"
            data-onstyle="danger"
            onchange="$('#childHidden, #childShow').slideToggle()"
            {% if form.child_form %}checked{% endif %} />
        <label class="m-l" data-toggle="tooltip" data-placement="right"
            title="Checking this box marks this page as a 'child form' of another.">
            Does this form contain name data?
        </label>
    </div>

    <img class="image-zoom" src="{{ form.filename|media }}" />

    <div id="childShow" class="form-group image-radio-group"
        {% if form.child_form == false %}style="display: none"{% endif %}>
        <label>Select the form which looks like the current form's parent</label><br />

        {% if form.filenameBefore %}
            <div class="image-radio">
                <input
                    name="parent_form_id"
                    value="{{ form.id - 1 }}"
                    type="radio"
                    id="image-radio-before"
                    {{ form.parent_form_id == form.id - 1 ? 'checked' : '' }} />
                <label for="image-radio-before">
                    <img src="{{ form.filenameBefore|media  }}" />
                </label>

                <a href="{{ form.filenameBefore|media  }}" target="_blank">
                    See image full size <i class="icon-external-link"></i>
                </a>
            </div>
        {% else %}
            <div class="image-radio alert-warning">
                No neighbouring form
            </div>
        {% endif %}

        {% if form.filenameAfter %}
            <div class="image-radio">
                <input
                    name="parent_form_id"
                    value="{{ form.id + 1 }}"
                    type="radio"
                    id="image-radio-after"
                    {{ form.parent_form_id == form.id + 1 ? 'checked' : '' }} />
                <label for="image-radio-after">
                    <img src="{{ form.filenameAfter|media }}" />
                </label>

                <a href="{{ form.filenameAfter|media  }}" target="_blank">
                    See image full size <i class="icon-external-link"></i>
                </a>
            </div>
        {% else %}
            <div class="image-radio alert-warning">
                No neighbouring form
            </div>
        {% endif %}
    </div>

    <div id="childHidden" {% if form.child_form %}style="display: none"{% endif %}>

        <div class="form-group">
            <label for="casualtyRank">Rank</label>

            <div class="checkbox">
                <label class="checkbox-inline">
                    <input type="checkbox" name="rank[]" value="2nd Lieut."
                        {% if "2nd Lieut." in form.rank %}checked{% endif %} />
                        2nd Lieut.
                </label>

                <label class="checkbox-inline">
                    <input type="checkbox" name="rank[]" value="Lieut."
                        {% if "Lieut." in form.rank %}checked{% endif %} />
                        Lieut.
                </label>

                <label class="checkbox-inline">
                    <input type="checkbox" name="rank[]" value="Captain"
                        {% if "Captain" in form.rank %}checked{% endif %} />
                        Captain
                </label>

                <label class="checkbox-inline">
                    <input type="checkbox" name="rank[]" value="Major"
                        {% if "Major" in form.rank %}checked{% endif %} />
                        Major
                </label>

                <label class="checkbox-inline">
                    <input type="checkbox" name="rank[]" value="Lt.-Col."
                        {% if "Lt.-Col." in form.rank %}checked{% endif %} />
                        Lt.-Col.
                </label>

                <label class="checkbox-inline">
                    <input type="checkbox" name="rank[]" value="Colonel"
                        {% if "Colonel" in form.rank %}checked{% endif %} />
                        Colonel
                </label>
            </div>
        </div>

        <div class="form-group">
            {% partial '@textfield'
                id="casualtyRegimentCorps"
                name="regiment_corps"
                label="Regiment/Corps"
                recordValue=form.regiment_corps %}
        </div>

        <div class="row">
            <div class="form-group col-sm-4">
                {% partial '@textfield'
                    id="casualtyFnames"
                    name="first_names"
                    label="Christian names"
                    recordValue=form.first_names %}
            </div>

            <div class="form-group col-sm-4">
                {% partial '@textfield'
                    id="casualtySurname"
                    name="surname"
                    label="Surname"
                    recordValue=form.surname %}
            </div>

            <div class="form-group col-sm-4">
                {% partial '@datefield'
                    id="casualtyBirthDate"
                    name="birth_date"
                    label="Date of birth"
                    recordValue=form.birth_date %}
            </div>
        </div>

    </div>

    <div class="row">
        <div class="form-group col-sm-4">
            {% partial '@datefield'
                id="casualtyReportDateFirst"
                name="report_date_first"
                label="Date of first report"
                recordValue=form.report_date_first %}
        </div>

        <div class="form-group col-sm-4">
            {% partial '@datefield'
                id="casualtyReportDateLast"
                name="report_date_last"
                label="Date of last report"
                recordValue=form.report_date_last %}
        </div>

        <div class="form-group col-sm-4">
            {% partial '@datefield'
                id="casualtyDeathDate"
                name="death_date"
                label="Date of death"
                recordValue=form.death_date %}
        </div>
    </div>

    <div class="form-group">
        <input type="hidden" name="medical_information" value="0" />
        <input id="medicalInfo" type="checkbox" name="medical_information"
            value="1" data-toggle="toggle" data-on="Yes" data-off="No"
            {% if form.medical_information %}checked{% endif %} />
        <label class="m-l" for="medicalInfo">
            Is there any additional medical information on the form?
        </label>
    </div>

    <input type="hidden" name="id" value="{{ form.id }}" />

    <div class="form-group pull-right">
        {% if stage == 'new'%}
            <input type="hidden" name="completed_by_id" value="{{ user.id }}" />
            <button type="submit" class="btn btn-primary">Save</button>
        {% elseif stage == 'approve' %}
            <input type="hidden" name="approved_by_id" value="{{ user.id }}" />
            <button type="submit" class="btn btn-success">Approve</button>
        {% endif %}
    </div>

    {% flash success %}
        <p>{{ message }}</p>
    {% endflash %}
</form>
